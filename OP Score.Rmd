---
title: "How could DWG dominant the world in S10"
author: "ABC"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  bookdown::pdf_document2:
    citation_package: natbib
bibliography: references.bib

subtitle: Result based on OP Score calculated with Bayesian regression Model
thanks: 'Code and data are available at: '
abstract: In year 2020, which is the Season 10 for League of Legend. DWG showed everyone their dominance against the world. This is another LCK Champion since 2 years ago. Before now, the public thought LCK is becoming out-dated along with the game's version updates, but now DWG proved them wrong. Just as the former champions, DWG gained its champion with absolutely advantages among other teams. In the report, I will use Bayesian Regression Model for factors influencing the outcome of a game, analysing the principle behind their victory. Found that the win rate from the local league of a team could be the most significant, and the kills per minute is the second. And of course, there are other factors have less effect but still important. Next step includes gaining new data from the next year, and update the model. Also, I will introduce more factors to reflect the dominance of a team.
toc: no
keywords: "League of Legend, DWG, S10 Championship, Bayesian Regression Model"
---

```{r setup, include=FALSE}
library(bookdown)
library(tidyverse)
library(brms)
```

# Introduction

This paper will analyze why DWG (DAMWON Gaming) can dominant every game in Season 10 which just ended a month ago. DWG made its Champion with only 2 losses in championship, which represent the highest competitive level around the world. This paper will introduce a new tool for measurement of a team's performance, and it is OP Score. This score is based on the team's match history from Season 10 (2020). 

League of Legends is a 5 vs 5 competitive game that are spilted to 2 sides. Players have to gain gold and level advantages in order to win a game. The most large source of gold is from netural resources and kills. Each opponent player kill could bring 300 golds, which could contribute a player's advantages. And the source of experience could also be kills, as well as minions and netural resources kills. Gaining experience could make player level up, as most game do. The higher the level, the stronger a player.

For a whole team's performance, there are several factors need to be considered. Each game in within a map, and there are neutral resources that players could take. These neutral resources are excludible, which means if the one side took the resources, then there is nothing left for the other side. Then it is important to gain advantages with these resources, and this includes: "Herald", "Dragon", "Baron". In this paper, the team which took the first herald could be an important factor in the rival, thus it is a factor for teams' performance. Then for "Baron", unlike "Herald", this resource appears in the late game, so it wouldn't be important whether which team get it first. Then the total number of "Barons" taken is more important as a factor. "Dragon" is more common resources among the others, it appears more frequently, so "number of dragons as advantages of a team" could specifically reflect a team's competitive ability and advantages during games. 

Another key factor is on statistics level. From the data of every game, its statistics could reflect which team is the winner of a game. The winner team usually has the higher "Damage per minute", since they could win most of the fights, they need more damages. Similarly, winner team could have more "Damage taken per minute", but this depends on several factors, since the loser team could also have higher damage taken as they lose most of the fights. Then, a important index between these two statistics is "Kills per Minute", it can explicitly reflect the team's condition, because winner teams always have more kills eventually. In the duration of a game, the time at 15 mins is significant since the game is changing from early stage to mid stage at this. If a team can gain large advantages at or before this time, then it is most likely this team will win this game, as the late stage only depends the advantages a team accumulated earlier. At last, the "Gold difference at 15mins" and "Experience difference at 15mins" could show a team's ability to get advantages in early-mid game, which is most important in winning a game.

The KDA (Kill Death Assist Ratio) could be a measurement for a player's performance in each game, then it could get a expectation of a player's KDA in the World Championship. The KDA is calulate by the ratio between number of kills, number of deaths and the number of assists. Incresing in number of deaths could lower the KDA, while increasing in the othetr two would make KDA higher. Also, vision score per minute and creep score per minute could reflect a player's ability to sense the macro of the game and ability to get the steady source of gold. The map contains a number of unseen area, which is called the war mist. Players can put a ward in a certain area to make the area visible for a period of time, and this is costly. So whether a player can use their ward to detect enemy is the way to determine player's sense of macro, the vision score is the measurement of it. If a ward doesn't detect any enemy, then the vision score wouldn't incresase. The creep score is referred to another neutral resources in the game, which is minion. Minions appear frequently and periodiocally, as each of them worth 15 golds to 90 golds. They comes as a wave of 6 minions, and the waves come each 30 seconds. Ensuring stable gold gains from minions could make the game more stable in winning. This is waht creep score does, and by calculating it as per minute could show a player's status in a game. 

In this paper, it will use the average value for each variable across the team's history, and using the data from their own league "LCK". These average values are being weighted by time, since the earlier data could reflect less for World Championship. The dependent variable would be explicitly the win rate by the team in world championship, which could be a representative rank for teams' performance. By aggregating these factors, it could conclude a OP Score for a whole team by bayesian regression model which could fit a apporiate distribution for the data and a more precise model. In this way, this paper will explore the which factor is the most important to dominant a game from DWG's score. And in the future, it could predict the performance for a team in Season 11 (2021) by this instrument as well.

# Data

```{r datasets, include=FALSE}
lck <- read_csv("./Input/lck_data.csv")
world <- read_csv("./Input/world_data.csv")
```

The data is provided by Tim Sevenhuysen of OraclesElixir.com.
It is consist of 2 parts, one is the data from their local league LCK, and the other is from the world championship.

## LCK Data

```{r winrate, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "Winrates for Teams in league LCK"}
lck %>%
  ggplot(aes(x=reorder(team, localwinrate), y=localwinrate)) + geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="Win Rates") + coord_flip()
#Plotting the distribution for Win rates based on LCK Data
```

```{r kpm, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "KPM for Teams in league LCK"}
lck %>%
  ggplot(aes(x=reorder(team, team_kpm), y=team_kpm)) + geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="KPM") + coord_flip()
#Plotting the distribution for Kills per Minite based on LCK Data
```

```{r gold, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "15mins Gold Difference for Teams in league LCK"}
meangold <- lck %>%
  group_by(team) %>%
  summarise(golddiffat15 = round(mean(golddiffat15, na.rm = TRUE),3))

meangold %>%
  ggplot(aes(x=reorder(team, golddiffat15), y=golddiffat15)) + geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="Gold Difference at 15mins") + coord_flip()
#Plotting the distribution for gold difference at 15mins based on LCK Data
```

## World Championship Data

```{r world-winrate, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "Win Rates for Teams in World Championship in league LCK"}
world %>%
  ggplot(aes(x=reorder(team, worldwinrate), y=worldwinrate)) + geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="Win Rates") + coord_flip()
#Plotting the distribution for Win rates based on World Championship Data
```



```{r world-dragon, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "Average Number of Dragons Advantages for Teams in World Championship"}
meandrag <- lck %>%
  group_by(team) %>%
  summarise(team_dragons_adv = round(mean(team_dragons_adv, na.rm = TRUE),3))

meandrag %>%
  ggplot(aes(x=reorder(team, team_dragons_adv), y=team_dragons_adv)) + geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="Average # of Dragons Advantages") + coord_flip()
#Plotting the distribution for umber of dragons taken based on World Championship Data
```


```{r world-baron, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "Gold Difference at 15mins for Teams in World Championship"}
meangoldwld <- world %>%
  group_by(team) %>%
  summarise(golddiffat15 = round(mean(golddiffat15, na.rm = TRUE),3))

meangoldwld %>%
  ggplot(aes(x=reorder(team, golddiffat15), y=golddiffat15)) + geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="Gold Difference at 15mins") + coord_flip()
#Plotting the distribution for Gold Difference at 15mins based on World Championship Data
```


## LCK & World Championship Data Comparison

```{r compare data, warning = FALSE, include=FALSE}
templck <- lck %>%
  filter(team == "Gen.G" | team == "DAMWON Gaming" | 
           team == "DRX")

tempworld <- world %>%
  filter(team == "Gen.G" | team == "DAMWON Gaming" | 
           team == "DRX")
# Only 3 LCK Teams made its qulification for World Championship

tempworld <- tempworld %>%
  rename(winrate = worldwinrate)
templck <- templck %>%
  rename(winrate = localwinrate)
names(tempworld) <- names(templck)
# Matching the variable names

total <- rbind(templck, tempworld)
# Binding 2 datasets by their rows
```

```{r compare-winrate, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "Comparison for Win Rates between LCK and Championship"}
total %>%
  ggplot(aes(x=reorder(team, winrate), y=winrate, fill=league)) + geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="Win Rate", fill="League") + coord_flip()
#Plotting the comparison for win rate
```

```{r compare-kpm, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "Comparison for KPM between LCK and Championship"}
totkpm <- total %>%
  group_by(league, team) %>%
  summarise(team_kpm = round(mean(team_kpm), 3))

totkpm %>%
  ggplot(aes(x=reorder(team, team_kpm), y=team_kpm, fill=league)) + geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="KPM", fill="League") + coord_flip()
#Plotting the comparison for Kills per minite
```

```{r compare-gold, message = FALSE,warning = FALSE, echo=FALSE, fig.height = 4, fig.width = 6, fig.cap = "Comparison for 15mins Gold Difference between LCK and Championship"}
totgold <- total %>%
  group_by(league, team) %>%
  summarise(golddiffat15 = round(mean(golddiffat15, na.rm = TRUE), 3))

totgold %>%
  ggplot(aes(x=reorder(team, golddiffat15), y=golddiffat15, fill=league)) + geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5, vjust = 0.5), plot.title = element_text(hjust = 0.5)) + 
  labs(x="Team", y="Gold Difference at 15mins", fill="League") + coord_flip()
#Plotting the comparison for gold difference at 15mins
```

# Model
```{r model, include=FALSE}
set.seed(777)
worldwr <- world %>%
  select(team, date, worldwinrate)

totaldata <- lck

ind <- match(totaldata$team, worldwr$team)
worldwinr <- worldwr$worldwinrate[ind]
totaldata$worldwinrate <- worldwinr
#This step will add win rate in world championship into LCK Data, will be better for modeling

totaldata$worldwinrate[is.na(totaldata$worldwinrate)] <- 0
#Some teams have world win rate with NA, because they didn't make their qualification for world championship. This step will replace these teams' winrates with 0%

totaldata <- totaldata %>%
  group_by(team) %>%
  summarise(worldwinrate = unique(worldwinrate),
            localwinrate = unique(localwinrate),
            KDA = weighted.mean(KDA, 1/timediff),
            vspm = weighted.mean(vspm, 1/timediff),
            cspm = weighted.mean(cspm, 1/timediff),
            team_dragons_adv = weighted.mean(team_dragons_adv, 1/timediff),
            firstheraldrate = weighted.mean(firstheraldrate, 1/timediff),
            barons = weighted.mean(barons, 1/timediff),
            team_kpm = weighted.mean(team_kpm, 1/timediff),
            dtpm = weighted.mean(dtpm, 1/timediff),
            dpm = weighted.mean(dpm, 1/timediff),
            golddiffat15 = weighted.mean(golddiffat15, 1/timediff, na.rm = TRUE),
            xpdiffat15 = weighted.mean(xpdiffat15, 1/timediff, na.rm = TRUE))

mod <- brm(worldwinrate ~ localwinrate + vspm + cspm + firstheraldrate + dpm + KDA + xpdiffat15 + golddiffat15 + team_dragons_adv + barons + team_kpm + dtpm, data = totaldata)

```

```{r lpl}
test <- lck %>%
  group_by(team) %>%
  summarise(localwinrate = unique(localwinrate),
            KDA = weighted.mean(KDA, 1/timediff),
            vspm = weighted.mean(vspm, 1/timediff),
            cspm = weighted.mean(cspm, 1/timediff),
            team_dragons_adv = weighted.mean(team_dragons_adv, 1/timediff),
            firstheraldrate = weighted.mean(firstheraldrate, 1/timediff),
            barons = weighted.mean(barons, 1/timediff),
            team_kpm = weighted.mean(team_kpm, 1/timediff),
            dtpm = weighted.mean(dtpm, 1/timediff),
            dpm = weighted.mean(dpm, 1/timediff),
            golddiffat15 = weighted.mean(golddiffat15, 1/timediff, na.rm = TRUE),
            xpdiffat15 = weighted.mean(xpdiffat15, 1/timediff, na.rm = TRUE))

pred <- predict(mod, newdata = test)
output <- data.frame(team = test$team, OP_Score = pred[,1])
output <- output[order(output$OP_Score, decreasing = TRUE),]
output
```

# Conclusion

# Weakness

# Reference

# Appendix
